<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Faroun Mining App</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg,#281a47 0%,#1d293f 100%);
      color: #fff;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      max-width: 340px;
      margin: 40px auto;
      background: #222347e6;
      border-radius: 16px;
      box-shadow: 0 2px 32px #0003;
      padding: 32px 16px 24px 16px;
      text-align: center;
    }
    input, button {
      font-size: 1.1em;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      width: 90%;
      background: #161633;
      color: #fff;
    }
    button {
      background: linear-gradient(90deg,#ffd700,#a37cf0);
      color: #23233b;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px #a37cf033;
      transition: 0.2s;
    }
    button:active {
      transform: scale(0.97);
    }
    .balance {
      font-size: 2em;
      margin: 16px 0 4px 0;
      color: #ffd700;
    }
    .usd {
      color: #b0eaff;
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    .refinput {
      background: #191933;
      color: #fff;
      border: none;
    }
    .features {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-top: 24px;
    }
    .feature {
      background: #2a2057;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 0.98em;
      width: 95%;
    }
    .menu {
      margin: 0 0 20px 0;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .menu button {
      flex: 1;
      padding: 8px 0;
      background: #23233b;
      color: #ffd700;
      font-size: 1em;
      transition: background 0.2s, color 0.2s;
    }
    .menu .active {
      background: linear-gradient(90deg,#ffd700,#a37cf0);
      color: #23233b;
    }
    .referral-link {
      font-size: 0.98em;
      background: #191933;
      padding: 6px 10px;
      border-radius: 6px;
      word-break: break-all;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>
  <script>
    // Constants
    const PRICE = 38.99;
    const SUPPLY = 120_000_000;
    const DEFAULT_RATE = 0.003;
    const REFERRAL_BONUS = 1;
    const REFERRAL_RATE = 0.01;

    // Helper: load/save user to localStorage
    function saveUser(user) {
      localStorage.setItem('frn_user', JSON.stringify(user));
    }
    function loadUser() {
      const data = localStorage.getItem('frn_user');
      return data ? JSON.parse(data) : null;
    }
    function saveRefUser(username, user) {
      localStorage.setItem('frn_user_' + username, JSON.stringify(user));
    }
    function loadRefUser(username) {
      const data = localStorage.getItem('frn_user_' + username);
      return data ? JSON.parse(data) : null;
    }

    // App state
    let user = loadUser();
    let view = 'mine'; // or 'profile' or 'ref'
    let message = '';
    let referral = '';

    // On load, check for ?ref
    (() => {
      const params = new URLSearchParams(window.location.search);
      if (params.get('ref')) referral = params.get('ref');
    })();

    function hoursSince(date) {
      if (!date) return 24;
      return Math.min(24, (Date.now() - new Date(date)) / (60 * 60 * 1000));
    }

    function render() {
      const app = document.getElementById('app');
      app.innerHTML = '';
      if (!user) {
        // Registration screen
        const html = `
          <h2>‚õèÔ∏è Faroun Mining</h2>
          <p>Enter your <b>Telegram username</b> to start mining FRN!</p>
          <input id="username" placeholder="Telegram Username" autocomplete="off"/>
          <input id="referral" class="refinput" placeholder="Referral (optional)" value="${referral || ''}" autocomplete="off"/>
          <button id="regbtn">Start Mining</button>
          <div style="color:#f88;margin-top:8px">${message}</div>
        `;
        app.innerHTML = html;
        document.getElementById('regbtn').onclick = () => {
          const username = document.getElementById('username').value.replace('@','').trim();
          const ref = document.getElementById('referral').value.replace('@','').trim();
          if (!username || username.length < 5) {
            message = 'Enter valid Telegram username (min 5 chars)';
            render(); return;
          }
          if (ref && ref.toLowerCase() === username.toLowerCase()) {
            message = "You can't refer yourself!";
            render(); return;
          }
          // Referral logic
          let refUser = ref ? loadRefUser(ref) : null;
          let newUser = {
            username,
            miningRate: DEFAULT_RATE,
            balance: 0,
            lastTap: null,
            referrals: [],
            totalEarned: 0,
            referralBonus: 0,
          };
          if (ref && refUser) {
            refUser.balance += REFERRAL_BONUS;
            refUser.miningRate += REFERRAL_RATE;
            refUser.referrals = refUser.referrals || [];
            refUser.referrals.push(username);
            saveRefUser(ref, refUser);
            newUser.balance = REFERRAL_BONUS;
            newUser.referralBonus = REFERRAL_BONUS;
            message = 'Referral applied! You and your referrer each got 1 FRN.';
          }
          user = newUser;
          saveUser(user);
          saveRefUser(username, user);
          render();
        };
        return;
      }

      // Menu
      app.innerHTML += `
        <div class="menu">
          <button class="${view==='mine'?'active':''}" id="minebtn">Mine</button>
          <button class="${view==='profile'?'active':''}" id="profilebtn">Profile</button>
          <button class="${view==='ref'?'active':''}" id="refbtn">Referrals</button>
        </div>
      `;

      // Mining view
      if (view === 'mine') {
        const percentMined = ((user.balance || 0) / SUPPLY) * 100;
        app.innerHTML += `
          <div class="balance">${user.balance.toFixed(4)} FRN</div>
          <div class="usd">‚âà $${(user.balance * PRICE).toLocaleString(undefined, { maximumFractionDigits: 2 })}</div>
          <div>Mining rate: <b>${user.miningRate.toFixed(3)} FRN/hr</b></div>
          <div style="margin:8px 0;"><progress value="${percentMined}" max="100" style="width:65%"></progress>
          <span style="font-size:13px;color:#ffd700">${percentMined.toFixed(5)}% mined</span></div>
          <button id="tapbtn">Tap to Mine</button>
          <div style="margin:8px 0 0 0;">Next tap: <b>${
            user.lastTap
              ? hoursSince(user.lastTap) < 24
                ? `${Math.ceil(24 - hoursSince(user.lastTap))}h`
                : 'Ready!'
              : 'Ready!'
          }</b></div>
          <div style="color:#0fa;margin:8px 0">${message}</div>
        `;
        document.getElementById('tapbtn').onclick = () => {
          if (user.lastTap && hoursSince(user.lastTap) < 24) {
            message = `You already mined recently! Come back in ${Math.ceil(24 - hoursSince(user.lastTap))}h`;
            render(); return;
          }
          const earned = user.miningRate * 24;
          user.balance += earned;
          user.lastTap = new Date().toISOString();
          user.totalEarned = (user.totalEarned || 0) + earned;
          saveUser(user);
          saveRefUser(user.username, user);
          message = `You mined ${earned.toFixed(4)} FRN!`;
          render();
        };
      }
      // Profile view
      else if (view === 'profile') {
        app.innerHTML += `
          <h3>üë§ Profile</h3>
          <div style="background:#23233b;padding:20px 8px;border-radius:12px;">
            <div>Telegram: <b>@${user.username}</b></div>
            <div>Balance: <b>${user.balance.toFixed(4)} FRN</b> ($${(user.balance*PRICE).toLocaleString(undefined, {maximumFractionDigits:2})})</div>
            <div>Mining Rate: <b>${user.miningRate.toFixed(3)} FRN/hr</b></div>
            <div>Total Earned: <b>${(user.totalEarned || 0).toFixed(4)} FRN</b></div>
            <div>Referrals: <b>${user.referrals.length}</b></div>
            ${user.referralBonus>0?`<div>Referral Bonus: <b>${user.referralBonus} FRN</b></div>`:''}
          </div>
        `;
      }
      // Referrals view
      else if (view === 'ref') {
        app.innerHTML += `
          <h3>üîó Referral Program</h3>
          <div>Share your link and get <b>+1 FRN</b> and <b>+0.01 FRN/hr</b> for each friend!</div>
          <div class="referral-link" id="reflink">${window.location.origin+window.location.pathname}?ref=${user.username}</div>
          <button id="copyref">Copy Link</button>
          <div style="margin:8px 0;"><b>${user.referrals.length}</b> friends joined with your link!</div>
          ${user.referrals.length > 0
            ? `<ul style="color:#9cf;font-weight:500;list-style:none;padding:0;">${user.referrals.map(r=>'<li>@'+r+'</li>').join('')}</ul>`
            : ''
          }
        `;
        document.getElementById('copyref').onclick = () => {
          const text = `${window.location.origin+window.location.pathname}?ref=${user.username}`;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(text);
            message = 'Referral link copied!';
            render();
          }
        };
      }
      // Features section (always show)
      app.innerHTML += `
        <div class="features">
          <div class="feature">üöÄ Leaderboard (coming soon!)</div>
          <div class="feature">üèÖ NFT Badges for streaks & referrals</div>
          <div class="feature">üî• Daily Streak Bonus</div>
          <div class="feature">üí∏ Withdraw to Telegram (future!)</div>
        </div>
        <footer style="margin:24px 0 0 0;color:#aaa;font-size:0.98em;">Faroun (FRN) &copy; 2025 | 1 FRN = $38.99 | Total supply: 120,000,000 FRN</footer>
      `;

      // Menu handlers
      document.getElementById('minebtn').onclick = () => { view='mine'; message=''; render(); };
      document.getElementById('profilebtn').onclick = () => { view='profile'; message=''; render(); };
      document.getElementById('refbtn').onclick = () => { view='ref'; message=''; render(); };
    }

    render();
  </script>
</body>
</html>